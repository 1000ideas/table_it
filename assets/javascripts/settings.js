// Generated by CoffeeScript 1.6.3
(function() {
  var MultipleSelectMatch, PluginSettings;

  MultipleSelectMatch = (function() {
    function MultipleSelectMatch(table_class) {
      var _this = this;
      this.table_class = table_class;
      $(document).on('click', "." + this.table_class + " + .add-next-match", function(event) {
        event.preventDefault();
        return _this.new_user(event.target);
      });
      $(document).on('click', "." + this.table_class + " .remove-match", function(event) {
        event.preventDefault();
        $(event.target).parents('tr').first().remove();
        return _this.update_json_setting();
      });
      $(document).on('change', "." + this.table_class + " select", function() {
        return _this.update_json_setting();
      });
      true;
    }

    MultipleSelectMatch.prototype.new_user = function(link) {
      var template;
      template = $($(link).data('template'));
      $(link).prev().find('tbody').append(template);
      return true;
    };

    MultipleSelectMatch.prototype.update_json_setting = function() {
      var matches,
        _this = this;
      matches = {};
      $("." + this.table_class + " tr").each(function(idx, el) {
        var key, value;
        key = $('select', el).first().val();
        value = $('select', el).last().val();
        if (key.length > 0 && value.length > 0) {
          return matches[key] = value;
        }
      });
      return $("#settings_" + this.table_class).val(JSON.stringify(matches));
    };

    return MultipleSelectMatch;

  })();

  PluginSettings = (function() {
    function PluginSettings() {
      var name, _i, _len, _ref;
      this.select_matches = {};
      _ref = ['default_users', 'default_activity'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        name = _ref[_i];
        this.select_matches[name] = new MultipleSelectMatch(name);
      }
    }

    return PluginSettings;

  })();

  jQuery(function() {
    return window.pluginSettings = new PluginSettings();
  });

}).call(this);
